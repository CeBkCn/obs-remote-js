/*!
 * OBS Remote JS API v1.0.0 (https://github.com/nodecg/obs-remote-js)
 * Copyright 2014 Matthew McNamara <matt@mattmcn.com>
 * Licensed under MIT (https://github.com/nodecg/obs-remote-js/blob/master/LICENSE)
 */
!function(){"use strict";function a(a,b,c,d,e,f){this.width=a||0,this.height=b||0,this.x=c||0,this.y=d||0,this.name=e||"",this.rendered=f||!1}"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports.OBSSource=a:window.OBSSource=a}(),function(){"use strict";function a(a,b){this.name=a||"",this.sources=b||[]}"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports.OBSScene=a:window.OBSScene=a}(),function(){"use strict";function a(){Object.defineProperty(this,"apiVersion",{value:1.1,writable:!1}),this._connected=!1,this._socket=void 0,this._messageCounter=0,this._responseCallbacks={},this._auth={salt:"",challenge:""}}function b(a,b){var c=d(a),h=d(this._auth.salt),i=e(c+h),j=this;g.subtle.digest("SHA-256",i).then(function(a){var c=d(f(a)),h=d(j._auth.challenge),i=e(c+h);g.subtle.digest("SHA-256",i).then(function(a){var c=f(a);b(c)})})}function c(a,b){var c=d(a),e=d(this._auth.salt),f=CryptoJS.SHA256(c+e).toString(CryptoJS.enc.Base64),g=d(f),h=d(this._auth.challenge),i=CryptoJS.SHA256(g+h).toString(CryptoJS.enc.Base64);b(i)}function d(a){return unescape(encodeURIComponent(a))}function e(a){for(var b=new Uint8Array(a.length),c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b.buffer}function f(a){for(var b,c,d,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f="",g=new Uint8Array(a),h=8*a.byteLength,i=0;h>i;i+=6)b=i/8|0,c=i%8,d=(g[b]||0)<<c>>2,c>2&&(d|=(g[b+1]||0)>>10-c),f+=e.charAt(63&d);return f+=4==c?"=":6==c?"==":""}var g=window.crypto||window.msCrypto||{};if(a.prototype._authHash=b,"undefined"==typeof g.subtle)if("undefined"==typeof g.webkitSubtle){if("undefined"==typeof CryptoJS)throw new Error("OBS Remote requires CryptoJS when native crypto is not available!");a.prototype._authHash=c}else g.subtle=g.webkitSubtle;Object.defineProperty(a,"DEFAULT_PORT",{value:4444,writable:!1}),Object.defineProperty(a,"WS_PROTOCOL",{value:"obsapi",writable:!1}),a.prototype.connect=function(b,c){c="undefined"==typeof c?"":c,b="undefined"==typeof b||""===b?"localhost":b;var d=b.indexOf(":");(0>d||d===b.length-1)&&(b+=":"+a.DEFAULT_PORT),this._connected&&(this._socket.close(),this._connected=!1),this._socket=new WebSocket("ws://"+b,a.WS_PROTOCOL);var e=this;this._socket.onopen=function(){e._connected=!0,e.onConnectionOpened(),e.isAuthRequired(function(a){a&&e.authenticate(c)})},this._socket.onclose=function(){e.onConnectionClosed(),e._connected=!1},this._socket.onerror=function(){e.onConnectionFailed(),e._connected=!1},this._socket.onmessage=function(a){e._messageReceived(a)}},a.prototype.authenticate=function(a){var b=this;this._authHash(a,function(a){function c(a){var c="ok"===a.status,d=0;c?b.onAuthenticationSuccessful():(d=a.error.substr(43),b.onAuthenticationFailed(d))}var d={auth:a};b._sendMessage("Authenticate",d,c)})},a.prototype.toggleStream=function(a){a="undefined"==typeof a?!1:a;var b={"preview-only":a};this._sendMessage("StartStopStreaming",b)},a.prototype.getVersion=function(a){function b(b){a(b.version)}this._sendMessage("GetVersion",b)},a.prototype.isAuthRequired=function(a){function b(b){var d=b.authRequired;d&&(c._auth.salt=b.salt,c._auth.challenge=b.challenge),a(d)}var c=this;this._sendMessage("GetAuthRequired",b)},a.prototype.getSceneList=function(){},a.prototype.onConnectionOpened=function(){},a.prototype.onConnectionClosed=function(){},a.prototype.onConnectionFailed=function(){},a.prototype.onStreamStarted=function(){},a.prototype.onStreamStopped=function(){},a.prototype.onAuthenticationSuccessful=function(){},a.prototype.onAuthenticationFailed=function(){},a.prototype._sendMessage=function(a,b,c){if(this._connected){var d=this._getNextMsgId();"function"==typeof b&&(c=b,b={}),b="undefined"==typeof b?{}:b,c="undefined"==typeof c?function(){}:c,this._responseCallbacks[d]=c,b["message-id"]=d,b["request-type"]=a;var e=JSON.stringify(b);this._socket.send(e)}},a.prototype._getNextMsgId=function(){return this._messageCounter+=1,this._messageCounter+""},a.prototype._messageReceived=function(a){var b=JSON.parse(a.data);if(b){var c=b["update-type"];if(c)switch(c){case"StreamStarting":this._onStreamStarting(b);break;case"StreamStopping":this._onStreamStopping(b);break;default:console.warn("[OBSRemote] Unknown OBS update type: "+c)}else{var d=b["message-id"];"error"===b.status&&console.error("[OBSRemote] Error:",b.error);var e=this._responseCallbacks[d];e(b),delete this._responseCallbacks[d]}}},a.prototype._onStreamStarting=function(a){var b=a["preview-only"];this.onStreamStarted(b)},a.prototype._onStreamStopping=function(a){var b=a["preview-only"];this.onStreamStopped(b)},"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=a:window.OBSRemote=a}();